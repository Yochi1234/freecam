-- Freecam System with Full Movement in All Directions (Mobile Friendly)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
repeat wait() until player and player.Character and player:FindFirstChild("PlayerGui")
local camera = workspace.CurrentCamera

local function clamp(val, min, max)
	return math.max(min, math.min(max, val))
end

-- Lock/Unlock Character Movement
local function disableCharacterMovement()
	local character = player.Character
	if character then
		local humanoid = character:FindFirstChildWhichIsA("Humanoid")
		if humanoid then
			humanoid.WalkSpeed = 0
			humanoid.JumpPower = 0
		end
	end
end

local function enableCharacterMovement()
	local character = player.Character
	if character then
		local humanoid = character:FindFirstChildWhichIsA("Humanoid")
		if humanoid then
			humanoid.WalkSpeed = 16
			humanoid.JumpPower = 50
		end
	end
end

-- UI Setup
local gui = Instance.new("ScreenGui", player.PlayerGui)
gu ResetOnSpawn = false
gu.Name = "FreecamGui"

local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0, 130, 0, 60)
toggleBtn.Position = UDim2.new(0, 20, 1, -90)
toggleBtn.Text = "Freecam"
toggleBtn.TextScaled = true
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleBtn.AnchorPoint = Vector2.new(0, 1)
toggleBtn.ZIndex = 10

local returnBtn = Instance.new("TextButton", gui)
returnBtn.Size = UDim2.new(0, 130, 0, 60)
returnBtn.Position = UDim2.new(0, 170, 1, -90)
returnBtn.Text = "Return"
returnBtn.TextScaled = true
returnBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
returnBtn.AnchorPoint = Vector2.new(0, 1)
returnBtn.Visible = false
returnBtn.ZIndex = 10

local joystickBase = Instance.new("Frame", gui)
joystickBase.Size = UDim2.new(0, 110, 0, 110)
joystickBase.Position = UDim2.new(0, 20, 1, -230)
joystickBase.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
joystickBase.BackgroundTransparency = 0.5
joystickBase.Visible = false
joystickBase.ClipsDescendants = true
joystickBase.AnchorPoint = Vector2.new(0, 1)
joystickBase.ZIndex = 10
joystickBase.BorderSizePixel = 0
joystickBase.Active = true

local joystickThumb = Instance.new("Frame", joystickBase)
joystickThumb.Size = UDim2.new(0, 50, 0, 50)
joystickThumb.Position = UDim2.new(0.5, -25, 0.5, -25)
joystickThumb.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
joystickThumb.BackgroundTransparency = 0.3
joystickThumb.AnchorPoint = Vector2.new(0.5, 0.5)
joystickThumb.BorderSizePixel = 0
joystickThumb.ZIndex = 11
joystickThumb.Visible = true

local upBtn = Instance.new("TextButton", gui)
upBtn.Size = UDim2.new(0, 60, 0, 60)
upBtn.Position = UDim2.new(1, -90, 1, -230)
upBtn.Text = "▲"
upBtn.TextScaled = true
upBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
upBtn.Visible = false
upBtn.AnchorPoint = Vector2.new(1, 1)
upBtn.ZIndex = 10

local downBtn = Instance.new("TextButton", gui)
downBtn.Size = UDim2.new(0, 60, 0, 60)
downBtn.Position = UDim2.new(1, -160, 1, -230)
downBtn.Text = "▼"
downBtn.TextScaled = true
downBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
downBtn.Visible = false
downBtn.AnchorPoint = Vector2.new(1, 1)
downBtn.ZIndex = 10

local isFreecam = false
local moveVector = Vector3.new()
local camRotation = Vector2.new(0,0)
local sensitivity = 0.005
local speed = 2

local dragging = false
local lastPos = nil
UserInputService.TouchStarted:Connect(function(input)
	if not isFreecam then return end
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		lastPos = input.Position
	end
end)

UserInputService.TouchMoved:Connect(function(input)
	if dragging and isFreecam then
		local delta = input.Position - lastPos
		lastPos = input.Position
		camRotation = camRotation + Vector2.new(-delta.X, -delta.Y) * sensitivity
		camRotation = Vector2.new(camRotation.X, clamp(camRotation.Y, -math.pi/2 + 0.1, math.pi/2 - 0.1))
	end
end)

UserInputService.TouchEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
	end
end)

local joystickDragging = false
local joystickCenter = joystickBase.AbsolutePosition + joystickBase.AbsoluteSize/2
local maxRadius = joystickBase.AbsoluteSize.X / 2

local function updateJoystick(inputPos)
	local delta = inputPos - joystickCenter
	local direction = (delta).Unit
	local distance = math.min(delta.Magnitude, maxRadius)
	local offset = direction * distance
	joystickThumb.Position = UDim2.new(0.5, offset.X, 0.5, offset.Y)
	moveVector = Vector3.new(offset.X / maxRadius, 0, offset.Y / maxRadius)
end

joystickBase.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		joystickDragging = true
		updateJoystick(input.Position)
	end
end)

joystickBase.InputChanged:Connect(function(input)
	if joystickDragging and input.UserInputType == Enum.UserInputType.Touch then
		updateJoystick(input.Position)
	end
end)

joystickBase.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		joystickDragging = false
		moveVector = Vector3.zero
		joystickThumb.Position = UDim2.new(0.5, 0, 0.5, 0)
	end
end)

local upPressed = false
local downPressed = false

upBtn.MouseButton1Down:Connect(function() upPressed = true end)
upBtn.MouseButton1Up:Connect(function() upPressed = false end)
downBtn.MouseButton1Down:Connect(function() downPressed = true end)
downBtn.MouseButton1Up:Connect(function() downPressed = false end)

toggleBtn.MouseButton1Click:Connect(function()
	if not isFreecam then
		local head = player.Character and player.Character:FindFirstChild("Head")
		if head then
			disableCharacterMovement()
			camera.CameraType = Enum.CameraType.Scriptable
			camera.CFrame = head.CFrame + Vector3.new(0, 5, 0)
			camRotation = Vector2.new(0, 0)
			isFreecam = true
			toggleBtn.Visible = false
			returnBtn.Visible = true
			joystickBase.Visible = true
			upBtn.Visible = true
			downBtn.Visible = true
		end
	end
end)

returnBtn.MouseButton1Click:Connect(function()
	if isFreecam then
		enableCharacterMovement()
		camera.CameraType = Enum.CameraType.Custom
		isFreecam = false
		toggleBtn.Visible = true
		returnBtn.Visible = false
		joystickBase.Visible = false
		upBtn.Visible = false
		downBtn.Visible = false
	end
end)

RunService.RenderStepped:Connect(function()
	if isFreecam then
		local cf = CFrame.new(camera.CFrame.Position)
			* CFrame.Angles(0, camRotation.X, 0)
			* CFrame.Angles(camRotation.Y, 0, 0)

		local right = camera.CFrame.RightVector
		local forward = camera.CFrame.LookVector
		local movement = (right * moveVector.X + forward * -moveVector.Z)
		local vertical = 0
		if upPressed then vertical = 1 elseif downPressed then vertical = -1 end

		if movement.Magnitude > 0 then
			movement = movement.Unit * speed
		end

		camera.CFrame = camera.CFrame + movement + Vector3.new(0, vertical * speed, 0)
		camera.CFrame = CFrame.new(camera.CFrame.Position)
			* CFrame.Angles(0, camRotation.X, 0)
			* CFrame.Angles(camRotation.Y, 0, 0)
	end
end)
